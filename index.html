<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì œ1íšŒ AI ì²œí•˜ì œì¼ ë¬´ìˆ ëŒ€íšŒ</title>
    <style>
        /* ìŠ¤íƒ€ì¼: ëª¨ë°”ì¼ ì¹œí™”ì  ë””ìì¸ */
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; text-align: center; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h1 { color: #4a4a4a; margin-bottom: 10px; }
        input { width: 90%; padding: 12px; margin: 8px 0; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        button { width: 100%; padding: 15px; margin-top: 10px; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        
        .btn-register { background-color: #4CAF50; color: white; }
        .btn-battle { background-color: #FF5722; color: white; margin-top: 30px; }
        
        #status { margin-top: 15px; color: #666; font-weight: bold; }
        #battle-log { margin-top: 20px; text-align: left; background: #2d2d2d; color: #00ff00; padding: 15px; border-radius: 10px; white-space: pre-wrap; min-height: 100px; font-family: monospace; line-height: 1.6; }
        .winner-text { color: #FFD700; font-size: 1.2em; font-weight: bold; text-align: center; display: block; margin-bottom: 10px;}
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ¥Š AI ë°°í‹€ ë¡œì–„</h1>
        <p>ë‚˜ë§Œì˜ ìºë¦­í„°ë¥¼ ë“±ë¡í•˜ê³  ìš°ìŠ¹ì— ë„ì „í•˜ì„¸ìš”!</p>

        <div id="register-zone">
            <input type="text" id="name" placeholder="ë‹‰ë„¤ì„ (ì˜ˆ: íŒŒì´ì¬ë§ˆìŠ¤í„°)">
            <input type="text" id="skill" placeholder="í•„ì‚´ê¸° (ì˜ˆ: ë¬´í•œë£¨í”„ ê±¸ê¸°)">
            <input type="text" id="desc" placeholder="íŠ¹ì§•/ì»¨ì…‰ (ì˜ˆ: ëˆì§ˆê¸´ ì„±ê²©)">
            <button class="btn-register" onclick="register()">ì°¸ê°€ ì‹ ì²­í•˜ê¸°</button>
        </div>

        <div id="status">í˜„ì¬ ì°¸ê°€ì: 0ëª…</div>

        <hr style="margin: 30px 0;">

        <div id="admin-zone">
            <h3>ğŸ† ê²½ê¸° ì¤‘ê³„ì„ (êµìˆ˜ë‹˜ìš©)</h3>
            <select id="p1-select"><option>ì„ ìˆ˜ 1 ì„ íƒ</option></select>
            <span> VS </span>
            <select id="p2-select"><option>ì„ ìˆ˜ 2 ì„ íƒ</option></select>
            <button class="btn-battle" onclick="startBattle()">âš”ï¸ ë°°í‹€ ì‹œì‘!</button>
        </div>

        <div id="battle-log">ê²½ê¸° ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
    </div>

    <script>
        // ============================================================
        // ğŸš¨ ì—¬ê¸°ì— Replit ì£¼ì†Œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”! (ë”°ì˜´í‘œ ìœ ì§€)
        // ============================================================
        const SERVER_URL = "https://0447153f-7427-4b99-bbc6-dea46f45d90b-00-19u3uwashraos.pike.replit.dev/"; 
        // ============================================================

        // 1. ì°¸ê°€ ì‹ ì²­ í•¨ìˆ˜
        async function register() {
            const name = document.getElementById('name').value;
            const skill = document.getElementById('skill').value;
            const desc = document.getElementById('desc').value;

            if(!name || !skill) return alert("ë‹‰ë„¤ì„ê³¼ ê¸°ìˆ ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");

            try {
                const res = await fetch(`${SERVER_URL}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, skill, desc })
                });
                const data = await res.json();
                
                if(res.ok) {
                    alert(data.message);
                    updateList(); // ëª…ë‹¨ ê°±ì‹ 
                } else {
                    alert("ì˜¤ë¥˜: " + data.detail);
                }
            } catch (e) {
                alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨! ì£¼ì†Œë¥¼ í™•ì¸í•˜ì„¸ìš”.");
            }
        }

        // 2. ë°°í‹€ ì‹œì‘ í•¨ìˆ˜
        async function startBattle() {
            const p1 = document.getElementById('p1-select').value;
            const p2 = document.getElementById('p2-select').value;

            if(p1 === p2 || p1.includes("ì„ íƒ")) return alert("ë‘ ëª…ì˜ ì„ ìˆ˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!");

            const logBox = document.getElementById('battle-log');
            logBox.innerHTML = "â³ ì‹¬íŒ(Gemini)ì´ íŒì • ì¤‘ì…ë‹ˆë‹¤... (ì•½ 3ì´ˆ ì†Œìš”)";

            try {
                const res = await fetch(`${SERVER_URL}/battle`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ p1_name: p1, p2_name: p2 })
                });
                const data = await res.json();

                // ê²°ê³¼ ì¶œë ¥ (íƒ€ì´í•‘ íš¨ê³¼ì²˜ëŸ¼ ë³´ì´ê²Œ)
                logBox.innerHTML = `<span class="winner-text">ğŸ† ìŠ¹ì: ${data.winner}</span>\n\n` + data.log + `\n\nğŸ‘‰ ìŠ¹ë¦¬ ìš”ì¸: ${data.reason}`;
            } catch (e) {
                logBox.innerText = "ì—ëŸ¬ ë°œìƒ! ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.";
            }
        }

        // 3. ì°¸ê°€ì ëª…ë‹¨ ë¶ˆëŸ¬ì˜¤ê¸° (ìë™)
        async function updateList() {
            try {
                const res = await fetch(`${SERVER_URL}/participants`);
                const list = await res.json();
                
                document.getElementById('status').innerText = `í˜„ì¬ ì°¸ê°€ì: ${list.length}ëª…`;

                // ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ì—…ë°ì´íŠ¸
                const opts = list.map(p => `<option value="${p.name}">${p.name}</option>`).join('');
                document.getElementById('p1-select').innerHTML = opts;
                document.getElementById('p2-select').innerHTML = opts;
            } catch (e) {
                console.log("ì„œë²„ ì•„ì§ ì•ˆ ì¼œì§");
            }
        }

        // 2ì´ˆë§ˆë‹¤ ëª…ë‹¨ ìë™ ê°±ì‹ 
        setInterval(updateList, 2000);
    </script>
</body>
</html>
